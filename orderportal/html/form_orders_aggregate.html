{# Select fields to aggregate for all orders for the form into a CSV file. #}

{% extends "base.html" %}

{% block head_title %}
Aggregate {{ terminology('orders') }}
for form {{ form['title'] or form['_id'] }}
{% end %}

{% block body_title %}
Aggregate {{ terminology('orders') }} 
for form  {% module Entity(form, icon=False) %}
{% end %}

{% block main_content %}
<form action="{{ reverse_url('form_orders_aggregate', form['_id']) }}"
      role="form"
      method="POST">
  {% module xsrf_form_html() %}

  <div class="form-group">
    <div class="row">
      <div class="col-md-9">
	<label class="control-label" for="order">
          {{ terminology('Order') }} metadata</label>
	<select multiple size="6" class="form-control" name="order" id="order">
          <option value="_id">IUID</option>
          <option value="identifier">Identifier</option>
          <option value="title">Title</option>
          <option value="status">Status</option>
          <option value="modified">Modified</option>
          <option value="created">Created</option>
        </select>
      </div>
    </div>
    <span class="help-block">
      Select {{ terminology('order') }} metadata to include.
      Multiple choice is allowed.
    </span>
  </div>
  
  <div class="form-group">
    <div class="row">
      <div class="col-md-9">
	<label class="control-label" for="history">
          {{ terminology('Order') }} history</label>
	<select multiple size="{{ len(settings['ORDER_STATUSES']) }}"
                class="form-control" name="history" id="history">
          {% for status in settings['ORDER_STATUSES'] %}
          <option>{{ status['identifier'] }}</option>
          {% end %}
        </select>
      </div>
    </div>
    <span class="help-block">
      Select status entries in the {{ terminology('order') }} history.
      Multiple choice is allowed.
    </span>
  </div>
  
  <div class="form-group">
    <div class="row">
      <div class="col-md-9">
	<label class="control-label" for="owner">
          {{ terminology('Order') }} owner</label>
	<select multiple size="4" class="form-control" name="owner" id="owner">
          <option value="email">Email</option>
          <option value="last_name">Last name</option>
          <option value="first_name">First name</option>
          <option value="university">University</option>
        </select>
      </div>
    </div>
    <span class="help-block">
      Select {{ terminology('order') }} owner data to include.
      Multiple choice is allowed.
    </span>
  </div>
  
  <div class="form-group">
    <div class="row">
      <div class="col-md-9">
	<label class="control-label" for="fields">
          {{ terminology('Order') }} fields</label>
	<select multiple size="{{ len(fields) }}"
                class="form-control" name="fields" id="fields">
          {% for field in fields %}
          <option>{{ field['identifier'] }}</option>
          {% end %}
        </select>
      </div>
    </div>
    <span class="help-block">
      Select {{ terminology('order') }} data fields.
      Multiple choice is allowed.
    </span>
  </div>
  
  {% if table_fields %}
  <div class="form-group">
    <div class="row">
      <div class="col-md-9">
	<label class="control-label" for="table_field">Table field</label>
        <div class="radio">
          <label>
            <input type="radio" name="table_field" id="table_field"
                   checked value=""> [none]
          </label>
        </div>
        {% for field in table_fields %}
        <div class="radio">
          <label>
            <input type="radio" name="table_field" id="table_field"
                   value="{{ field['identifier']}}"> {{ field['identifier']}}
          </label>
        </div>
        {% end %}
      </div>
    </div>
    <span class="help-block">
      Select one or zero {{ terminology('order') }} table data field.
      It is not possible to select specified subfields of the table data field;
      all subfields will be output.
      <br>
      <b>Note</b>: For each row in the field table all other data
      specified above will be repeated. This amounts to an INNER JOIN
      of two tables, where the first table is the order data, and the
      second table is the field data. This means that no rows will be
      produced if there is no data in the field table.
    </span>
  </div>
  {% end %} {# if table_fields #}
  
  <div class="form-group">
    <div class="row">
      <div class="col-md-3">
        <button type="submit" class="btn btn-lg btn-info">
          <span class="glyphicon glyphicon-th"></span>
          Aggregate
        </button>
      </div>
    </div>
    <span class="help-block">
      A CSV file containing data for the fields specified above will be
      produced and returned.
    </span>
  </div>
</form>
{% end %} {# block main_content #}
