{# Search page. #}

{% extends "base.html" %}

{% block head_title %}Search{% end %}
{% block body_title %}Search{% end %}

{% block search_field %}{% end %}

{% block content %}
<form action="{{ reverse_url('search', **params) }}"
      role="form" class="form-inline"
      method="GET">
  <input type="hidden" name="page" value="{{ params.get('page') or 0 }}">
  <div class="row">
    <div class="col-md-7 col-md-offset-3">
      <div class="form-group">
	<input type="text" name="term" id="term"
	       class="form-control" value="{{ params.get('term') or '' }}">
      </div>
      <div class="form-group">
	<button type="submit"
	  class="btn btn-primary glyphicon glyphicon-search">
	  Search
	</button>
      </div>
    </div>
    <div class="col-md-2">
    </div>
  </div>
</form>

{% if max_page > 0 %}
<div class="row">
  <div class="col-md-6 col-md-offset-2">
    <ul class="pager">
      <li>
	{% set current = params.get('page', 0) %}
	{% set params['page'] = 0 %}
	<a href="{{ reverse_url('search', **params) }}">
	  <span class="glyphicon glyphicon-fast-backward"></span>
	  First
	</a>
      </li>
      <li>
	{% set params['page'] = max(0, current-1) %}
	<a href="{{ reverse_url('search', **params) }}">
	  <span class="glyphicon glyphicon-step-backward"></span>
	  Previous
	</a>
      </li>
      <li>
	<a href="{{ reverse_url('search', **params) }}">
	  {{ start }} to {{ end }} (of {{ count }})
	</a>
      </li>
      <li>
	{% set params['page'] = min(max_page, current+1) %}
	<a href="{{ reverse_url('search', **params) }}">
	  Next
	  <span class="glyphicon glyphicon-step-forward"></span>
	</a>
      </li>
      <li>
	{% set params['page'] = max_page %}
	<a href="{{ reverse_url('search', **params) }}">
	  Last
	  <span class="glyphicon glyphicon-fast-forward"></span>
	</a>
      </li>
    </ul>
  </div>
  <div class="col-md-4">
  </div>
</div>
{% else %}
<br>
{% end %} {# if max_page > 0 #}

<div class="row">
  <div class="col-md-10 col-md-offset-1">
    <table class="table table-striped table-condensed">
      <tr>
	<th>Item</th>
	<th>Owner</th>
	<th>Modified</th>
      </tr>
      {% for item in items %}
      <tr>
	<td>
	  {% if item['orderportal_doctype'] == constants.ORDER %}
	  <img src="{{ static_url('order.png') }}" alt="Order" title="Order">
	  <a href="{{ reverse_url('order', item['_id']) }}">{{ item.get('title', item['title']) }}</a>
	  {% end %}
	</td>
	<td>
	  <a href="{{ reverse_url('account', item['owner']) }}">{{ item['owner'] }}</a>
	</td>
	<td class="localtime">{{ item['modified'] }}</td>
      </tr>
      {% end %}
    </table>
  </div>
  <div class="col-md-1">
  </div>
</div>
{% end %}{# block content #}
