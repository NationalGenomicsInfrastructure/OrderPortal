{# Order fields recursive display. #}

{% for field in fields %}

  {# Check if field may not be seen. #}
  {% if field['restrict_read'] and not is_staff %}
  {% continue %}
  {% end %}

{% if field['type'] == constants.GROUP %}
<tr>
  <th>
    {% raw '&nbsp;&nbsp;-&nbsp;&nbsp;' * field['depth'] %}
    {{ field.get('label') or field['identifier'].capitalize() }}
  </th>
  <td></td>
  <td>
    {% if field['restrict_read'] %}
    [Staff only]
    {% end %}
    {{ field.get('description') or '' }}
  </td>
  <td>
    {% if field['identifier'] in order['invalid'] %}
    <span class="text-danger glyphicon glyphicon-remove">
      ({{ order['invalid'][field['identifier']] }})
    </span>
    {% else %}
    <span class="text-success glyphicon glyphicon-ok">
    </span>
    {% end %}
  </td>
</tr>

{# Recursion: 'include' cannot be used! #}
{% module Template('order_fields.html', order=order, fields=field['fields'], is_staff=is_staff) %}

{% else %}
<tr>
  <th>
    {% raw '&nbsp;&nbsp;-&nbsp;&nbsp;' * field['depth'] %}
    {{ field.get('label') or field['identifier'].capitalize() }}
  </th>
  <td>{{ order['fields'][field['identifier']] or '-' }}</td>
  <td>
    {% if field['restrict_read'] %}
    [Staff only]
    {% end %}
    {{ field.get('description') or '-' }}
  </td>
  <td>
    {% if field['identifier'] in order['invalid'] %}
    <span class="text-danger glyphicon glyphicon-remove">
      ({{ order['invalid'][field['identifier']] }})
    </span>
    {% else %}
    <span class="text-success glyphicon glyphicon-ok">
    </span>
    {% end %}
  </td>
</tr>

{% end %}
{% end %} {# for field in fields #}
