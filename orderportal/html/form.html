{# Form page. #}

{% extends "base.html" %}

{% block head_title %}Form '{{ form['title'] }}'{% end %}
{% block body_title %}Form '{{ form['title'] }}'{% end %}

{% block meta_content %}

<form action="{{ reverse_url('form_copy', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit"
	  class="btn btn-primary glyphicon glyphicon-plus-sign">
    Copy
  </button>
</form>

{% if form['status'] == constants.PENDING %}
<br>
<form action="{{ reverse_url('form_enable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-success glyphicon glyphicon-ok"
	  onclick="return confirm('Cannot be undone! Really enable?');">
    Enable
  </button>
</form>

{% elif form['status'] == constants.ENABLED %}
<br>
<form action="{{ reverse_url('form_disable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-danger glyphicon glyphicon-remove">
    Disable
  </button>
</form>

{% elif form['status'] == constants.DISABLED %}
<br>
<form action="{{ reverse_url('form_enable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-success glyphicon glyphicon-ok">
    Enable
  </button>
</form>
{% end %}

{% end %} {# block meta_content #}

{% block main_content %}
<div class="panel panel-default">
  <div class="panel-heading">
    Metadata
    <form action="{{ reverse_url('form_edit', form['_id']) }}"
	  role="form" class="panel-form pull-right" method="GET">
      <button type="submit"
	      class="btn btn-xs btn-primary glyphicon glyphicon-edit">
	Edit
      </button>
    </form>
  </div>

  <div class="panel-body">
    <table class="table-condensed table-fields">
      <tr>
	<th>Description</th>
	<td>{{ form.get('description') or '' }}</td>
      </tr>

      <tr>
	<th>Status</th>
	<td>{% module Icon(form['status'], label=True) %}</td>
      </tr>

      <tr>
	<th>Modified</th>
	<td>
	  <span class="localtime">{{ form['modified'] }}</span>
	  <a href="{{ reverse_url('form_logs', form['_id']) }}">
	    {% module Icon('logs', label=True) %}
	  </a>
	</td>
      </tr>

      <tr>
	<th>Created</th>
	<td class="localtime">{{ form['created'] }}</td>
      </tr>

    </table>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    Fields
    {% if form['status'] == constants.PENDING %}
    <form action="{{ reverse_url('field_create', form['_id']) }}"
	  role="form" class="pull-right" method="GET">
      <button type="submit"
	      class="btn btn-xs btn-primary glyphicon glyphicon-plus">
	Create field
      </button>
    </form>
    {% end %}
  </div>

  <div class="panel-body">

    <table class="table">
      <tr>
	<th>Identifier</th>
	<th>Label</th>
	<th>Type</th>
	<th>Required</th>
	<th>Restricted read</th>
	<th>Restricted write</th>
	<th>Description</th>
      </tr>
      {% for field in fields %}
      <tr>
	<td class="text-nowrap">
	  {% for i in xrange(field['depth']) %}
	  <span class="glyphicon glyphicon-play"></span>
	  {% end %}
	  <a href="{{ reverse_url('field_edit', form['_id'], field['identifier']) }}">{{ field['identifier'] }}</a></td>
	<td>{{ field.get('label') or '-' }}</td>
	<td>{{ field['type'] }}</td>
	<td>
	  {% if field['required'] %}
	  <span class="glyphicon glyphicon-star" style="color: red;">
	  {% end %}
	</td>
	<td>
	  {% if field['restrict_read'] %}
	  <span class="glyphicon glyphicon-ok">
	  {% end %}
	</td>
	<td>
	  {% if field['restrict_write'] %}
	  <span class="glyphicon glyphicon-ok">
	  {% end %}
	</td>
	<td>{{ field.get('description') or '-' }}</td>
      </tr>
      {% end %}
    </table>
  </div>
</div>
{% end %} {# block main_content #}
