{# Form page. #}

{% extends "base.html" %}

{% block head_title %}Form '{{ form['title'] }}'{% end %}
{% block body_title %}Form '{{ form['title'] }}'{% end %}

{% if is_admin %}
{% block meta_content %}

<form action="{{ reverse_url('form_edit', form['_id']) }}"
      role="form" method="GET">
  <button type="submit"
	  class="btn btn-primary glyphicon glyphicon-edit">
    Edit
  </button>
</form>

{% if form['status'] == constants.PENDING %}
<br>
<form action="{{ reverse_url('field_create', form['_id']) }}"
      role="form" method="GET">
  <button type="submit"
	  class="btn btn-primary glyphicon glyphicon-plus">
    Create field
  </button>
</form>
{% end %}

{% if form['status'] == constants.PENDING %}
<br>
<form action="{{ reverse_url('form_enable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-success glyphicon glyphicon-ok"
	  onclick="return confirm('Cannot be undone! Really enable?');">
    Enable
  </button>
</form>

{% elif form['status'] == constants.ENABLED %}
<br>
<form action="{{ reverse_url('form_disable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-danger glyphicon glyphicon-remove">
    Disable
  </button>
</form>

{% elif form['status'] == constants.DISABLED %}
<br>
<form action="{{ reverse_url('form_enable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-success glyphicon glyphicon-ok">
    Enable
  </button>
</form>
{% end %}

<br>
<form action="{{ reverse_url('form_copy', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit"
	  class="btn btn-primary glyphicon glyphicon-plus-sign">
    Copy
  </button>
</form>

{% end %} {# block meta_content #}
{% end %} {# if is_admin #}

{% block main_content %}
<table class="table table-striped">
  <tr>
    <th>Description</th>
    <td>{{ form.get('description') or '' }}</td>
  </tr>

  <tr>
    <th>Status</th>
    <td>{% module Icon(form['status'], label=True) %}</td>
  </tr>

  <tr>
    <th>Modified</th>
    <td>
      <span class="localtime">{{ form['modified'] }}</span>
      <a href="{{ reverse_url('form_logs', form['_id']) }}">
	{% module Icon('logs', label=True) %}
      </a>
    </td>
  </tr>

  <tr>
    <th>Created</th>
    <td class="localtime">{{ form['created'] }}</td>
  </tr>

  <tr>
    <th>Fields</th>
    <td>
      <table class="table table-condensed">
	<tr>
	  <th>Identifier</th>
	  <th>Label</th>
	  <th>Type</th>
	  <th></th>
	  <th>Restricted read</th>
	  <th>Restricted write</th>
	  <th>Description</th>
	</tr>
	{% for field in fields %}
	<tr>
	  <td class="text-nowrap">
	    {% raw '-&nbsp;'*field['depth'] %}
	    <a href="{{ reverse_url('field_edit', form['_id'], field['identifier']) }}">{{ field['identifier'] }}</a></td>
	  <td>{{ field.get('label') or '-' }}</td>
	  <td>{{ field['type'] }}</td>
	  <td>
	    {% if field['required'] %}{% module Icon('required') %}{% end %}
	  </td>
	  <td>{{ field['restrict_read'] }}</td>
	  <td>{{ field['restrict_write'] }}</td>
	  <td>{{ field.get('description') or '-' }}</td>
	</tr>
	{% end %}
      </table>
    </td>
  </tr>
</table>

{% end %} {# block main_content #}
